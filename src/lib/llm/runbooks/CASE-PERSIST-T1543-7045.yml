case_id: CASE-PERSIST-T1543-7045
threat_type: PERSIST
threat_type_kr: 예약 작업·서비스 악용(지속성 확보)
technique_id: T1543
technique_name_kr: (시스템 프로세스 생성 또는 수정)
event_ids: [7045]
log_fields: |
  Service Name
  Service File Name
  Service Type
  Start Type
  Service Account
log_reason: |
  이 이벤트는 새로운 서비스가 시스템에 설치되었을 때 반드시 기록되는 핵심 로그이다.
  exe, PowerShell(New-Service), regsvr32, LOLBins 등을 통해 악성 실행 파일을 서비스로 등록하면 7045가 단일 신호로 명확히 남는다.
  특히 binPath 필드에 비정상 경로(C:\Users\Public, Temp, AppData 등)나 실행 파일이 포함되면 악성 서비스 생성 정황을 확인할 수 있다.
log_scenario: |
  원격 침투 이후 권한 상승을 위해 공격자가 악성 exe를 서비스로 등록하는 경우, PowerShell이나 sc.exe로 백도어 서비스를 생성하는 경우, 정상 서비스 이름으로 위장한 악성 서비스 등록, 재부팅 시 자동 실행을 위해 지속성 확보 목적으로 서비스가 추가되는 경우 등에서 발생한다.
summary: |
  Windows에서는 공격자가 서비스 형태를 새로 만들거나 기존 서비스를 수정해 지속적으로 악성 페이로드를 실행할 수 있다.
  서비스는 부팅 시 자동 실행되고 SYSTEM 권한으로 동작하기 때문에, 공격자가 악성 실행 파일을 서비스로 등록하면 재부팅 후에도 계속 실행되며 높은 권한을 얻는 데 악용될 수 있다.
policy_direction: |
  시스템 프로세스 생성·수정 기반 공격을 막기 위해서는 서비스 생성·수정 권한을 엄격히 제한하고, 서비스가 실행하는 바이너리의 경로와 무결성을 보호해야 한다.
  공격자는 주로 sc.exe, PowerShell(New-Service) 같은 도구를 이용해 악성 실행 파일을 서비스로 등록하므로, 서비스 등록 경로나 실행 파일 배치 경로를 통제하면 지속성을 확보하기 어려워진다.
  또한 SYSTEM 권한으로 동작하는 서비스는 악성코드가 높은 권한을 획득하는 핵심 경로이므로, 서비스 계정 권한 최소화와 비정상 실행 파일 경로 차단이 중요하다.
  핵심은 서비스 실행 환경의 무결성 보장·서비스 등록 권한 최소화·경로 통제이다.
steps:
  - title: 상세 설정
    details: |
      services.msc에서 서비스 속성의 파일 경로(binPath)를 정기적으로 점검하고, Temp·AppData·Public 경로에 위치한 실행 파일이 서비스로 등록되지 않도록 정책적으로 금지한다
  - title: AppLocker 설정
    details: |
      AppLocker/WDAC 정책을 적용해 sc.exe, powershell.exe(New-Service), regsvr32.exe 같은 서비스 생성·수정 도구를 관리자만 실행할 수 있도록 제한한다
      
      C:\\Windows\\System32\\ 및 C:\\Windows\\System32\\Drivers\\ 같은 서비스 실행 파일 경로에 대해 NTFS 권한을 점검해 일반 사용자가 파일 생성·변경을 하지 못하도록 보호한다
  - title: 상세 설정
    details: |
      마지막으로 필요 없는 서비스는 “사용 안 함(Disabled)”으로 전환해 공격자가 기존 서비스 이름을 위장해 악성 파일로 교체하는 공격 표면을 줄인다
operations_guidance: |
  ## 모니터링 팁
  - Event ID 7045에서 Service Name 필드를 주의 깊게 확인하세요.
  - 비정상적인 패턴이나 짧은 시간 내 반복적인 접근을 모니터링하세요.
  - (시스템 프로세스 생성 또는 수정) 기법과 관련된 활동을 주의 깊게 관찰하세요.

  ## 오탐 가능성
  - 정상적인 시스템 관리 작업에서도 해당 이벤트가 발생할 수 있습니다.
  - 예약된 작업이나 백업 프로세스에 의한 정상 활동을 구분해야 합니다.

  ## 대응 방법
  - 관리자 작업은 사전 승인 프로세스를 적용하세요.
  - 예약된 작업은 화이트리스트로 등록하세요.
references:
  - title: MITRE ATT&CK - T1543
    url: https://attack.mitre.org/techniques/T1543/
  - title: Microsoft Event ID 7045
    url: https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-7045
