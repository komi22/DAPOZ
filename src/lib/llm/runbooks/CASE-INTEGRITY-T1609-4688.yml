case_id: CASE-INTEGRITY-T1609-4688
threat_type: INTEGRITY
threat_type_kr: 무결성 위협(데이터 조작)
technique_id: T1609
technique_name_kr: (컨테이너 관리 명령)
event_ids: [4688]
log_fields: |
  New Process Name
  Process Command Line
  Account Name
log_reason: |
  컨테이너 관리 명령 실행 시 생성되는 로그로 컨테이너 관리 명령 악용을 직접 포착한다.
  이벤트 로그의 자세히 항목에서 New Process Name을 봤을 때 dockerd.exe, docker.exe, kubectl.exe가 확인되면 컨테이너 관리 도구 실행을 확인할 수 있어서 컨테이너 명령 실행 가능성을 의심할 수 있다.
  이때 New Process Name 확인 시 docker.exe 또는 kubectl.exe가 핵심이며, dockerd.exe는 백그라운드 서비스로 실행되기 때문에 4688에 나타나지 않을 수도 있다.
  Account Name을 봤을 때 비관리자 계정으로 Docker/Kubernetes 관리 명령 실행이 확인되면 의심 비인가 컨테이너 접근을 확인할 수 있다.
log_scenario: |
  Windows Docker Desktop 또는 Kubernetes Windows 노드에서 docker exec -it container cmd.exe, kubectl exec -powershell 실행 시 생성된다.
  정상 개발자 작업에서도 발생하나, 비정상 시간대/비관리자 계정 패턴으로 컨테이너 탈출 및 명령 실행 탐지 시 확인해야 하는 이벤트 로그이다.
summary: |
  공격자는 컨테이너 관리 서비스를 악용하여 컨테이너 내에서 명령을 실행할 수 있다.
  Docker 데몬, Kubernetes API 서버 또는 kubelet과 같은 컨테이너 관리 서비스는 환경 내 컨테이너의 원격 관리를 허용할 수 있다.
  Docker에서 공격자는 스크립트나 명령을 실행하는 컨테이너 배포 중에 진입점을 지정하거나 docker exec실행 중인 컨테이너 내에서 명령을 실행하는 것과 같은 명령을 사용할 수 있다.
  Kubernetes에서 공격자가 충분한 권한을 가지고 있다면 Kubernetes API 서버인 kubelet과 상호 작용하거나 다음과 같은 명령을 실행하여 클러스터의 컨테이너에서 원격 실행 권한을 얻을 수 있다.
policy_direction: |
  컨테이너 관리 명령 악용을 방지하기 위해서는 docker.exe·kubectl.exe 같은 컨테이너 관리 도구를 실행할 수 있는 계정을 제한하고, 해당 도구가 컨테이너 내부에서 임의 명령을 실행하지 못하도록 권한을 최소화해야 한다.
  공격자는 컨테이너 exec 기능을 이용해 내부 명령 실행 또는 컨테이너 탈출을 노리므로, 컨테이너 관리 인터페이스(Docker Daemon, Kubernetes API)에 대한 접근 통제가 반드시 필요하다.
  또한 일반 사용자나 비인가 계정이 컨테이너 관리 명령을 실행하지 못하도록 역할 기반 접근 제어(RBAC)와 인증·토큰 관리 정책을 강화해야 한다.
  핵심은 컨테이너 관리 권한 최소화, 관리 도구 실행 통제, API 접근 제한이다.
steps:
  - title: AppLocker 관련 설정
    details: |
      AppLocker 또는 WDAC 정책을 적용해 docker.exe, kubectl.exe, ctr.exe 등 컨테이너 관리 도구가 특정 관리자 그룹 사용자만 실행할 수 있도록 제한한다
      
      Docker Desktop 또는 Kubernetes 클러스터를 사용하는 경우, Docker 데몬의 접근 제어에서 npipe:////./pipe/docker_engine 접근 권한을 Administrators만 갖도록 조정해 일반 계정이 docker exec를 실행하지 못하게 한다
      
      또한 Kubernetes 환경에서는 kubeconfig 파일(%USERPROFILE%\\kube\\config)에 대한 파일 권한을 조정해 비인가 사용자가 kubectl 명령을 실행할 수 없도록 한다
  - title: 상세 설정
    details: |
      마지막으로 컨테이너 runtime 관련 서비스(예: Docker Desktop Service)의 실행 계정을 최소 권한으로 유지하고, 불필요한 컨테이너 실행·관리 기능을 비활성화해 컨테이너 내부 명령 실행 경로를 사전에 차단한다
operations_guidance: |
  ## 모니터링 팁
  - Event ID 4688에서 New Process Name 필드를 주의 깊게 확인하세요.
  - 비정상적인 패턴이나 짧은 시간 내 반복적인 접근을 모니터링하세요.
  - (컨테이너 관리 명령) 기법과 관련된 활동을 주의 깊게 관찰하세요.

  ## 오탐 가능성
  - 정상적인 시스템 관리 작업에서도 해당 이벤트가 발생할 수 있습니다.
  - 예약된 작업이나 백업 프로세스에 의한 정상 활동을 구분해야 합니다.

  ## 대응 방법
  - 관리자 작업은 사전 승인 프로세스를 적용하세요.
  - 예약된 작업은 화이트리스트로 등록하세요.
references:
  - title: MITRE ATT&CK - T1609
    url: https://attack.mitre.org/techniques/T1609/
  - title: Microsoft Event ID 4688
    url: https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4688
