case_id: CASE-USER-T1059-4688
threat_type: USER
threat_type_kr: 사용자 부주의
technique_id: T1059
technique_name_kr: 명령 및 스크립팅 인터프리터
event_ids: [4688]
log_fields: |
  New Process Name
  New Process ID
  Process Command Line
  Parent Process Name
  Mandatory Level
log_reason: |
  프로세스 생성 시 확인되는 로그이다.
  사용자가 명령 인터프리터를 통해 실제 명령을 실행했을 때 기록되는 핵심 로그 중 하나이다.
  New Process Name을 봤을 때 powershell.exe, wscript.exe, cscript.exe가 확인되면 명령 인터프리터 실행을 확인할 수 있어서 악성 스크립트 실행 가능성을 의심할 수 있다.
  Process Command Line에 EncodedCommand, w hidden, IEX (New-Object Net.WebClient).DownloadString('http...')가 확인되면 의심 PowerShell 다운로드들을 확인할 수 있어서 코드 실행 행위를 의심할 수 있다.
  Parent Process Name을 봤을 때 explorer.exe 또는 Office 프로세스(winword.exe)에서 직접 powershell.exe 호출이 확인되면 의심 비정상 인터프리터 실행을 확인할 수 있다.
  Mandatory Level을 확인하면 높은 권한으로 실행된 공격 명령 여부도 추가적으로 식별할 수 있다.
log_scenario: |
  powershell.exe /c powershell, cscript.exe //B malicious.vbs 실행 시 생성된다.
  정상 관리 작업에서도 발생하나, 비정상 인코딩/옵션/부모 프로세스 패턴으로 악성 스크립트 실행 탐지 시 확인해야 한다.
summary: |
  공격자는 명령 및 스크립트 인터프리터를 악용하여 명령, 스크립트 또는 바이너리를 실행할 수 있다.
  이러한 인터페이스와 언어는 컴퓨터 시스템과 상호 작용하는 방법을 제공하며 다양한 플랫폼에서 공통적으로 사용되는 기능이다.
  공격자는 이러한 기술을 다양한 방식으로 악용하여 임의의 명령을 실행할 수 있다.
  명령과 스크립트는 피해자에게 유인 문서 형태로 전송되는 초기 접근 페이로드에 내장되거나 기존 C2에서 다운로드되는 보조 페이로드로 전송될 수 있다.
  공격자는 또한 대화형 터미널/셸을 통해 명령을 실행할 수 있으며, 다양한 원격 서비스를 활용하여 원격 실행을 달성할 수도 있다.
policy_direction: |
  명령 및 스크립팅 인터프리터 악용을 막기 위해서는 PowerShell·cmd·wscript·cscript 등 스크립트 실행 엔진이 임의로 실행되거나 자동으로 호출되지 못하도록 실행 체인을 제한하는 것이 핵심이다.
  공격자는 인코딩된 명령(-enc), 숨김 실행(-w hidden), IEX 다운로드 등 스크립트 기반 페이로드를 활용하므로, 스크립트 실행 정책과 다운로드 기능을 제한해 악성 코드 실행이 가능하지 않은 환경을 만들어야 한다.
  또한 문서·브라우저·Explorer와 같은 사용자 프로세스가 명령 인터프리터를 직접 호출할 수 없도록 차단하면 대부분의 스크립트 기반 공격을 초기 단계에서 막을 수 있다.
  즉, 스크립트 실행 제한·LOLbins 통제·부모-
  자식 프로세스 체인 차단이 핵심이다.
steps:
  - title: 상세 설정
    details: |
      PowerShell 실행 정책을 Set-ExecutionPolicy AllSigned 또는 Restricted로 설정해 서명되지 않은 스크립트·임의 스크립트 실행을 차단한다
  - title: AppLocker 설정
    details: |
      AppLocker/WDAC 정책을 적용해 powershell.exe, pwsh.exe, cmd.exe, wscript.exe, cscript.exe, mshta.exe 등 주요 스크립트 인터프리터가 일반 사용자 프로세스(Outlook, Word, Chrome, Explorer 등)에서 실행되지 못하도록 부모-자식 실행 체인을 제한한다
      
      또한 Temp, AppData, Downloads 경로에서 스크립트·실행파일이 동작하지 못하도록 실행 권한을 제거하면 공격자가 스테이징한 스크립트를 실행하기 어렵다
  - title: 상세 설정
    details: |
      마지막으로 브라우저·메일 클라이언트의 SmartScreen/첨부파일 보호 기능을 활성화해 외부에서 내려받은 스크립트나 실행파일이 자동 실행되는 경로를 막는다
operations_guidance: |
  ## 모니터링 팁
  - Event ID 4688에서 New Process Name 필드를 주의 깊게 확인하세요.
  - 비정상적인 패턴이나 짧은 시간 내 반복적인 접근을 모니터링하세요.
  - 명령 및 스크립팅 인터프리터 기법과 관련된 활동을 주의 깊게 관찰하세요.

  ## 오탐 가능성
  - 정상적인 시스템 관리 작업에서도 해당 이벤트가 발생할 수 있습니다.
  - 예약된 작업이나 백업 프로세스에 의한 정상 활동을 구분해야 합니다.

  ## 대응 방법
  - 관리자 작업은 사전 승인 프로세스를 적용하세요.
  - 예약된 작업은 화이트리스트로 등록하세요.
references:
  - title: MITRE ATT&CK - T1059
    url: https://attack.mitre.org/techniques/T1059/
  - title: Microsoft Event ID 4688
    url: https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4688
