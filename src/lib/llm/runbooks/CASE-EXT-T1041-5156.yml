case_id: CASE-EXT-T1041-5156
threat_type: EXT
threat_type_kr: 의도적 외부 공격자
technique_id: T1041
technique_name_kr: C2 채널을 통한 유출
event_ids: [5156]
log_fields: |
  Source Address
  Destination Address
  Destination Port
  Protocol
  Bytes Sent/Bytes Received
log_reason: |
  악성 프로세스가 외부 서버로 비정상적인 양의 데이터를 전송할 때 반복적으로 나타난다.
  동일 프로세스에서 짧은 시간 안에 특정 외부 IP/도메인으로 반복 연결이 발생하면, 해당 프로세스를 통한 지속적인 C2 통신·데이터 유출 채널 가능성을 의심할 수 있다.
  (실제 전송량은 별도 네트워크 로그/NetFlow로 확인 필요)
log_scenario: |
  악성 프로세스가 외부 C2 서버로 대량의 송신 트래픽이 발생할 때 나타난다.
  짧은 시간 내 지속적인 외부 전송, 평소 사용하지 않는 해외 IP로의 반복적인 업로드성 연결, 비정상적으로 큰 데이터 전송이 감지되면 계정정보·키로깅 결과·내부 문서 등의 실제 데이터 유출 시도로 판단할 수 있다.
summary: |
  공격자는 기존 C2 채널을 이용해 데이터를 외부로 빼낼 수 있다.
  유출되는 정보는 C2 통신과 동일한 프로토콜 안에 인코딩되어 전송되며, 겉보기에는 일반 트래픽처럼 보이기 때문에 탐지가 어려워진다.
policy_direction: |
  C2 기반 데이터 유출을 막기 위해서는 내부 시스템이 외부 서버로 대량 송신(Bytes Sent) 트래픽을 발생시키는 행위를 원천적으로 제한해야 한다.
  유출은 정상 HTTPS·DNS 트래픽에 숨겨지기 때문에, 특정 애플리케이션·계정만 외부로 데이터 전송을 허용하는 방식으로 통신 경로를 최소화하는 것이 핵심이다.
  또한 평소 접속하지 않던 외부 IP·도메인으로의 지속적 연결을 제한하고, 비업무 애플리케이션의 아웃바운드 업로드 자체를 차단해 C2 트래픽 악용을 어렵게 만들어야 한다.
  궁극적으로는 “업무 목적 데이터만 외부 송신을 허용하는 최소 통신 구조”가 데이터 유출 방어의 바탕이 된다.
steps:
  - title: 상세 설정
    details: |
      wf.msc(고급 방화벽)에서 아웃바운드 트래픽 정책을 허용 리스트 기반으로 구성하고, 브라우저 및 업무 애플리케이션만 외부 통신을 허용해 비정상 프로세스(powershell, cmd, wscript 등)의 외부 업로드를 차단한다
      
      또한 특정 국가·IP 대역으로의 송신 트래픽을 차단하는 방화벽 규칙을 구성해 해외 C2 서버로의 데이터 유출 가능성을 낮출 수 있다
      
      DNS는 내부 DNS 서버만 사용하도록 강제해 악성 프로세스가 외부 DNS 터널링 방식으로 데이터를 보내는 경로를 줄인다
  - title: 상세 설정
    details: |
      마지막으로 FTP·SFTP·SMTP 등 업로드 기능이 있는 클라이언트 기능을 비활성화하거나 제거해 공격자의 데이터 전송 경로 자체를 축소한다
operations_guidance: |
  ## 모니터링 팁
  - Event ID 5156에서 Source Address 필드를 주의 깊게 확인하세요.
  - 비정상적인 패턴이나 짧은 시간 내 반복적인 접근을 모니터링하세요.
  - C2 채널을 통한 유출 기법과 관련된 활동을 주의 깊게 관찰하세요.

  ## 오탐 가능성
  - 정상적인 시스템 관리 작업에서도 해당 이벤트가 발생할 수 있습니다.
  - 예약된 작업이나 백업 프로세스에 의한 정상 활동을 구분해야 합니다.

  ## 대응 방법
  - 관리자 작업은 사전 승인 프로세스를 적용하세요.
  - 예약된 작업은 화이트리스트로 등록하세요.
references:
  - title: MITRE ATT&CK - T1041
    url: https://attack.mitre.org/techniques/T1041/
  - title: Microsoft Event ID 5156
    url: https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5156
